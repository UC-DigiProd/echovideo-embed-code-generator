<style>
    /* Import Lato font */
    @import url('https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap');

    .generator-container {
        max-width: 600px;
        margin: 20px auto;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-family: 'Lato', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        color: #414042;
    }
    .generator-container h3 {
        color: #414042;
    }
    .generator-container label {
        display: block;
        margin-top: 10px;
        font-weight: bold;
    }
    .generator-container input[type="text"],
    .generator-container textarea {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
        font-family: inherit;
        color: inherit;
    }
    .generator-container .button-group {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        margin-bottom: 20px;
    }
    .generator-container button {
        background-color: #009ABC;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1em;
        font-family: inherit;
        transition: background-color 0.2s ease;
        flex-grow: 1;
        margin-top: 0;
    }
    .generator-container button:hover {
        background-color: #006C91;
    }
    
    #resetButton {
        background-color: #A9A9A9;
    }
    #resetButton:hover {
        background-color: #808080;
    }

    #outputCode {
        background-color: #f4f4f4;
        border: 1px solid #ddd;
        padding: 15px;
        margin-top: 5px;
        white-space: pre-wrap;
        word-break: break-all;
        min-height: 50px;
        font-family: monospace;
        color: #333;
        overflow-x: auto;
    }
    .syntax-tag { color: #0066cc; }
    .syntax-attr { color: #cc0066; }
    .syntax-value { color: #009900; }
    .syntax-text { color: #333; }
    
    #copyButton {
        padding: 8px 12px;
        font-size: 0.9em;
        margin-top: 10px;
        background-color: #009ABC; 
        transition: background-color 0.2s ease;
        display: block;
        width: 100%;
        box-sizing: border-box;
    }
    #copyButton:hover {
        background-color: #006C91;
    }
</style>

<div class="generator-container">
    <h3>Echo video embed code generator (for Canvas LMS)</h3>

    <label for="videoTitle">Video title:</label>
    <input type="text" id="videoTitle" placeholder="Video title">

    <label for="source">Source:</label>
    <input type="text" id="source" value="UC">

    <label for="year">Year:</label>
    <input type="text" id="year" value="2026">

    <label for="ltiCode">Echo LTI iframe code (paste full code including the opening and closing iframe tags):</label>
    <textarea id="ltiCode" rows="5" placeholder=""></textarea>

    <div class="button-group">
        <button onclick="generateCode()">Generate HTML code</button>
        <button id="resetButton" onclick="resetGenerator()">Reset generator</button>
    </div>

    <label for="outputCode">Generated code (copy and paste this code into the canvas page, replacing the original LTI iframe code):</label>
    <div id="outputCode"></div>
    
    <button id="copyButton" onclick="copyCode()" style="display: none;">Copy code to clipboard</button>
</div>

<script>
    // Store the plain text version for copying
    let plainTextCode = '';

    function generateCode() {
        const title = document.getElementById('videoTitle').value.trim();
        const source = document.getElementById('source').value.trim();
        const year = document.getElementById('year').value.trim();
        const ltiCode = document.getElementById('ltiCode').value.trim();
        const outputDiv = document.getElementById('outputCode');
        const copyBtn = document.getElementById('copyButton');

        // 1. Validate Input
        if (!title || !ltiCode) {
            outputDiv.textContent = 'Please provide a Video title and the Echo LTI iframe Code.';
            copyBtn.style.display = 'none';
            return;
        }

        // 2. Extract the [src] attribute
        const srcRegex = /src=["'](.*?)["']/i;
        const match = ltiCode.match(srcRegex);
        
        if (!match || match.length < 2) {
            outputDiv.textContent = 'Error: Could not extract a valid [src] attribute from the provided LTI code.';
            copyBtn.style.display = 'none';
            return;
        }

        const srcValue = match[1];

        // 3. Construct the Final HTML (plain text version)
        plainTextCode = 
`<div style="display: flex; justify-content: center; align-items: center; max-width: 704px; min-width: 320px; margin: auto;">
    <div style="position: relative; width: 100%; padding-bottom: 65.625%; height: 0;"><iframe class="lti-embed" style="border: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;" title="Echo video: ${title}" role="region" src="${srcValue}" name="Echo Video Player iframe" loading="lazy" allowfullscreen="allowfullscreen" webkitallowfullscreen="webkitallowfullscreen" mozallowfullscreen="mozallowfullscreen" allow="geolocation *; microphone *; camera *; midi *; encrypted-media *; autoplay *; clipboard-write *; display-capture *" aria-label="Echo video player"></iframe></div>
</div>
<p style="text-align: center;">Source: <a href="${srcValue}" target="_blank" rel="noopener">${title}</a> (${source}, ${year})</p>`;

        // 4. Create syntax-highlighted version for display
        const highlightedHtml = syntaxHighlight(plainTextCode);
        
        // 5. Display the highlighted code
        outputDiv.innerHTML = highlightedHtml;
        copyBtn.style.display = 'block'; 
    }
    
    function syntaxHighlight(code) {
        // Escape HTML entities first
        const escaped = code
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
        
        // Apply syntax highlighting
        return escaped
            // Highlight tags
            .replace(/(&lt;\/?)([\w-]+)/g, '<span class="syntax-tag">$1$2</span>')
            .replace(/(&gt;)/g, '<span class="syntax-tag">$1</span>')
            // Highlight attributes
            .replace(/([\w-]+)(=)/g, '<span class="syntax-attr">$1</span>$2')
            // Highlight attribute values
            .replace(/=(&quot;|")(.*?)(&quot;|")/g, '=<span class="syntax-value">&quot;$2&quot;</span>');
    }
    
    function copyCode() {
        const copyBtn = document.getElementById('copyButton');
        
        // Copy the plain text version
        if (!plainTextCode || plainTextCode.includes('Please provide') || plainTextCode.includes('Error: Could not extract')) {
             alert('No valid code generated yet to copy.');
             return;
        }

        navigator.clipboard.writeText(plainTextCode).then(() => {
            copyBtn.textContent = 'Copied!';
            setTimeout(() => {
                copyBtn.textContent = 'Copy code to clipboard';
            }, 2000);
        }).catch(err => {
            console.error('Failed to copy: ', err);
            alert('Failed to copy the code. Please try selecting the text manually.');
        });
    }

    function resetGenerator() {
        document.getElementById('videoTitle').value = '';
        document.getElementById('source').value = 'UC';
        document.getElementById('year').value = '2026';
        document.getElementById('ltiCode').value = '';
        
        document.getElementById('outputCode').innerHTML = '';
        document.getElementById('copyButton').style.display = 'none';
        plainTextCode = '';
    }
</script>
